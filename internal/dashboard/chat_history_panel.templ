package dashboard

import (
	"obsidian-automation/internal/database/sqlc"
)

templ ChatHistoryPanel(messages []sqlc.ChatHistory) {
	<div 
		class="bg-[#111114] p-6 rounded-xl shadow-2xl border border-gray-800"
		hx-get="/dashboard/panels/chat_history" 
		hx-trigger="every 5s"
		hx-swap="outerHTML"
	>
		<h2 class="text-[10px] font-bold mb-6 flex items-center uppercase tracking-[0.2em] text-gray-500">
			<span class="material-icons mr-2 text-blue-500 text-sm">history</span>
			Conversation History
		</h2>
		<div class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar">
			if len(messages) == 0 {
				<div class="text-center py-12 text-gray-600 border-2 border-dashed border-gray-800 rounded-xl">
					No conversation history found
				</div>
			}
			for _, msg := range messages {
				<div class={ "flex ", templ.KV("justify-end", msg.Direction == "out"), templ.KV("justify-start", msg.Direction == "in") }>
					<div class={ "max-w-[80%] rounded-lg p-3 ", 
								templ.KV("bg-blue-600/20 border border-blue-500/30 text-blue-100", msg.Direction == "out"), 
								templ.KV("bg-gray-800 border border-gray-700 text-gray-300", msg.Direction == "in") }>
						<div class="text-[8px] font-bold uppercase mb-1 opacity-50 flex justify-between">
							<span>{ msg.Direction }</span>
							<span>{ msg.CreatedAt.Format("02 Jan 15:04") }</span>
						</div>
						<div class="text-[11px] whitespace-pre-wrap font-sans leading-relaxed">
                            if msg.TextContent.Valid {
                                { msg.TextContent.String }
                            } else {
                                <span class="italic opacity-50">No content</span>
                            }
                        </div>
						if msg.FilePath.Valid && msg.FilePath.String != "" {
							<div class="mt-2 pt-2 border-t border-white/10 flex items-center space-x-2">
								<span class="material-icons text-xs">attach_file</span>
								<span class="text-[9px] font-mono opacity-70 truncate">{ msg.FilePath.String }</span>
							</div>
						}
					</div>
				</div>
			}
		</div>
	</div>
}
